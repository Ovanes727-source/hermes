workflows:
  android-debug:
    name: Android Debug Build
    max_build_duration: 30
    environment:
      vars:
        PACKAGE_NAME: "com.example.hermes" # –ó–∞–º–µ–Ω–∏ –Ω–∞ —Ç–≤–æ–π package name
    scripts:
      - name: Setup and Build
        script: |
          echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
          
          # –î–µ–ª–∞–µ–º gradlew –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
          if [ -f "./gradlew" ]; then
            chmod +x ./gradlew
            echo "‚úÖ gradlew —Å–¥–µ–ª–∞–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º"
          else
            echo "‚ùå gradlew –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏:"
            ls -la
            exit 1
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º Java
          echo "–í–µ—Ä—Å–∏—è Java:"
          java -version
          
          echo "üöÄ –°–æ–±–∏—Ä–∞–µ–º Debug APK..."
          ./gradlew assembleDebug --stacktrace --info
          
          if [ $? -eq 0 ]; then
            echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!"
            
            # –ù–∞—Ö–æ–¥–∏–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ APK
            APK_FILES=$(find . -name "*.apk" -type f)
            if [ -z "$APK_FILES" ]; then
              echo "‚ö†Ô∏è APK —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!"
              echo "–ò—â–µ–º –≤ app/build/outputs:"
              find app/build/outputs -type f
            else
              echo "üì¶ –ù–∞–π–¥–µ–Ω—ã APK —Ñ–∞–π–ª—ã:"
              echo "$APK_FILES" | while read file; do
                echo "  - $file"
                ls -lh "$file"
              done
            fi
          else
            echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏!"
            exit 1
          fi
          
      - name: Verify Build
        script: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏..."
          
          # –ò—â–µ–º APK –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
          APK_PATHS=(
            "app/build/outputs/apk/debug"
            "app/build/outputs/apk"
            "app/build/outputs"
            "build/outputs"
          )
          
          for path in "${APK_PATHS[@]}"; do
            if [ -d "$path" ]; then
              echo "üìÅ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É: $path"
              find "$path" -name "*.apk" -type f | while read apk; do
                echo "‚úÖ –ù–∞–π–¥–µ–Ω APK: $apk"
                echo "   –†–∞–∑–º–µ—Ä: $(ls -lh "$apk" | awk '{print $5}')"
                echo "   –î–∞—Ç–∞: $(date -r "$apk")"
              done
            fi
          done
          
          # –ò—â–µ–º –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ
          TOTAL_APKS=$(find . -name "*.apk" -type f | wc -l)
          echo "üìä –í—Å–µ–≥–æ APK —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ: $TOTAL_APKS"
          
          if [ $TOTAL_APKS -eq 0 ]; then
            echo "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: APK —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!"
            echo "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ app/build:"
            find app/build -type d 2>/dev/null || echo "–ü–∞–ø–∫–∞ app/build –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          fi
          
    artifacts:
      - app/build/outputs/apk/debug/*.apk
      - app/build/outputs/apk/*.apk
      - app/build/outputs/**/*.apk
      
    publishing:
      email:
        recipients:
          - ovanes727@icloud.com
