workflows:
  android-release:
    name: Android Build
    max_build_duration: 60
    environment:
      android_signing:
        - your_keystore_here # –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ AppCircle
      groups:
        - keystore_credentials
      vars:
        PACKAGE_NAME: "com.example.hermes" # –ó–∞–º–µ–Ω–∏ –Ω–∞ —Ç–≤–æ–π package name
        GRADLEW_PATH: "./gradlew"
    scripts:
      - name: Set up environment
        script: |
          # –î–µ–ª–∞–µ–º gradlew –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
          if [ -f "$GRADLEW_PATH" ]; then
            chmod +x "$GRADLEW_PATH"
            echo "‚úÖ gradlew —Å–¥–µ–ª–∞–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º"
          else
            echo "‚ùå gradlew –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: $GRADLEW_PATH"
            ls -la .
            exit 1
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Java
          java -version
          
      - name: Build APK
        script: |
          echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É APK..."
          ./gradlew assembleDebug --stacktrace --info
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          if [ $? -eq 0 ]; then
            echo "‚úÖ APK —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω"
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–¥–µ —Å–æ–∑–¥–∞–ª–∏—Å—å APK
            find app/build/outputs -name "*.apk" -type f | while read file; do
              echo "üì¶ –ù–∞–π–¥–µ–Ω APK: $file"
              ls -lh "$file"
            done
            
            # –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ APK
            APK_COUNT=$(find app/build/outputs -name "*.apk" -type f | wc -l)
            echo "üìä –í—Å–µ–≥–æ APK —Å–æ–∑–¥–∞–Ω–æ: $APK_COUNT"
          else
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ APK"
            exit 1
          fi
          
      - name: Build Release AAB (optional)
        script: |
          echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É AAB..."
          ./gradlew bundleRelease --stacktrace --info
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          if [ $? -eq 0 ]; then
            echo "‚úÖ AAB —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω"
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–¥–µ —Å–æ–∑–¥–∞–ª–∏—Å—å AAB
            find app/build/outputs -name "*.aab" -type f | while read file; do
              echo "üì¶ –ù–∞–π–¥–µ–Ω AAB: $file"
              ls -lh "$file"
            done
          else
            echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å AAB (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å)"
          fi
          
    artifacts:
      - app/build/outputs/**/*.apk
      - app/build/outputs/**/*.aab
      
    publishing:
      email:
        recipients:
          - ovanes727@icloud.com
