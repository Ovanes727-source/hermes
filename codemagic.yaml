workflows:
  android-debug:
    name: Android Debug Build
    max_build_duration: 30
    environment:
      vars:
        PACKAGE_NAME: "com.example.hermes"
    scripts:
      - name: Diagnostic
        script: |
          echo "ğŸ” Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°..."
          echo "========================================"
          echo "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ: $(pwd)"
          echo "========================================"
          echo ""
          
          echo "ğŸ“ ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞ¸:"
          ls -la
          echo ""
          
          echo "ğŸ” Ğ˜Ñ‰ĞµĞ¼ Gradle Ñ„Ğ°Ğ¹Ğ»Ñ‹:"
          find . -name "*.gradle*" -type f | head -20
          echo ""
          
          echo "ğŸ” Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ğ°Ğ¿ĞºÑƒ app:"
          find . -type d -name "app" 2>/dev/null | head -5
          echo ""
          
          echo "ğŸ” Ğ˜Ñ‰ĞµĞ¼ settings.gradle:"
          find . -name "settings.gradle*" -type f
          echo ""
          
          echo "ğŸ” Ğ˜Ñ‰ĞµĞ¼ build.gradle Ğ² ĞºĞ¾Ñ€Ğ½Ğµ:"
          find . -maxdepth 2 -name "build.gradle*" -type f
          echo ""
          
          echo "ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Android Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:"
          find . -name "AndroidManifest.xml" -o -name "build.gradle" | head -10
          echo ""
          
          echo "ğŸ”§ Ğ’ĞµÑ€ÑĞ¸Ñ Gradle Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ:"
          gradle --version 2>/dev/null || echo "Gradle Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          echo ""
          
      - name: Try Different Build Approaches
        script: |
          echo "ğŸš€ ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹ ÑĞ±Ğ¾Ñ€ĞºĞ¸..."
          echo "========================================"
          
          # ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 1: Ğ˜Ñ‰ĞµĞ¼ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ settings.gradle
          if [ -f "settings.gradle" ] || [ -f "settings.gradle.kts" ]; then
            echo "âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ settings.gradle, ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚..."
            gradle assembleDebug --stacktrace --info
            exit $?
          fi
          
          # ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 2: Ğ˜Ñ‰ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ app
          APP_DIR=$(find . -type d -name "app" -path "*/app" | head -1)
          if [ -n "$APP_DIR" ] && [ -f "$APP_DIR/build.gradle" ] || [ -f "$APP_DIR/build.gradle.kts" ]; then
            echo "âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ app Ğ²: $APP_DIR"
            echo "ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ² Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ..."
            
            # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
            if [[ "$APP_DIR" == "./"* ]]; then
              # Ğ•ÑĞ»Ğ¸ app Ğ² ĞºĞ¾Ñ€Ğ½Ğµ
              cd "$(dirname "$APP_DIR")"
              echo "Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸Ğ·: $(pwd)"
              gradle assembleDebug --stacktrace --info
              exit $?
            fi
          fi
          
          # ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 3: Ğ˜Ñ‰ĞµĞ¼ Ğ»ÑĞ±Ğ¾Ğ¹ build.gradle
          GRADLE_FILE=$(find . -name "build.gradle" -o -name "build.gradle.kts" | head -1)
          if [ -n "$GRADLE_FILE" ]; then
            echo "âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ gradle Ñ„Ğ°Ğ¹Ğ»: $GRADLE_FILE"
            echo "ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ¼..."
            cd "$(dirname "$GRADLE_FILE")"
            echo "Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸Ğ·: $(pwd)"
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞµÑÑ‚ÑŒ Ğ»Ğ¸ settings.gradle Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ
            if [ -f "../settings.gradle" ] || [ -f "../settings.gradle.kts" ]; then
              cd ..
              echo "ĞĞ°Ğ¹Ğ´ĞµĞ½ settings.gradle Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ñ‹ÑˆĞµ, ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸Ğ·: $(pwd)"
            fi
            
            gradle assembleDebug --stacktrace --info
            exit $?
          fi
          
          # ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 4: Ğ•ÑĞ»Ğ¸ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾, ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
          echo "âš ï¸ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ gradle Ñ„Ğ°Ğ¹Ğ»Ñ‹. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ..."
          echo "Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ĞºĞ¾Ñ€Ğ½Ñ:"
          ls -la
          
          echo "ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ..."
          if [ -d "src" ] || [ -d "app/src" ]; then
            echo "ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° src, Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ..."
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ build.gradle
            cat > build.gradle << 'EOF'
plugins {
    id 'com.android.application'
}

android {
    namespace 'com.example.app'
    compileSdk 34
    
    defaultConfig {
        applicationId "com.example.app"
        minSdk 24
        targetSdk 34
        versionCode 1
        versionName "1.0"
    }
    
    buildTypes {
        debug {
            debuggable true
        }
    }
}
EOF
            gradle assembleDebug --stacktrace --info
            exit $?
          fi
          
          echo "âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°!"
          exit 1
          
      - name: Find and Show Artifacts
        script: |
          echo "ğŸ“¦ Ğ˜Ñ‰ĞµĞ¼ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹ ÑĞ±Ğ¾Ñ€ĞºĞ¸..."
          echo "========================================"
          
          # Ğ˜Ñ‰ĞµĞ¼ APK Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ…
          APK_FILES=$(find . -name "*.apk" -type f 2>/dev/null)
          
          if [ -n "$APK_FILES" ]; then
            echo "âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½Ñ‹ APK Ñ„Ğ°Ğ¹Ğ»Ñ‹:"
            echo "$APK_FILES" | while read file; do
              echo "  ğŸ“± $file ($(ls -lh "$file" | awk '{print $5}'))"
            done
            echo ""
            echo "Ğ’ÑĞµĞ³Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: $(echo "$APK_FILES" | wc -l) APK"
          else
            echo "âš ï¸ APK Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹!"
            echo ""
            echo "ğŸ” Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº ÑĞ±Ğ¾Ñ€ĞºĞ¸:"
            find . -type d -name "build" 2>/dev/null | while read dir; do
              echo "ğŸ“‚ $dir:"
              find "$dir" -type f -name "*.apk" -o -name "*.aab" | head -5
              [ $? -eq 0 ] || echo "  (Ğ¿ÑƒÑÑ‚Ğ¾)"
            done
          fi
          
    artifacts:
      - "**/*.apk"
      - "**/build/outputs/**/*.apk"
      - "app/build/outputs/**/*.apk"
      
    publishing:
      email:
        recipients:
          - ovanes727@icloud.com
